<!-- Add this inside your <body> tag, replacing the referral-related JS and input block -->

<input type="text" id="link" readonly>
<button id="copyButton">Copy Link</button>

<!-- Referral List -->
<ul class="referral-list" id="referralList"></ul>

<script>
    Telegram.WebApp.ready();

    const userId = Telegram.WebApp.initDataUnsafe?.user?.id || Math.floor(Math.random() * 1000000);
    const userName = Telegram.WebApp.initDataUnsafe?.user?.username || "User_" + userId;

    // Set referral link
    const referralLink = `https://t.me/CLAIMDOGSS_BOT?start=${userId}`;
    document.getElementById('link').value = referralLink;

    // Handle copy button
    document.getElementById('copyButton').onclick = function () {
        navigator.clipboard.writeText(referralLink);
        alert("Referral link copied!");
    };

    // Simulated referral tracking using localStorage
    function loadUserData() {
        const userKey = `user_${userId}`;
        let userData = JSON.parse(localStorage.getItem(userKey));
        if (!userData) {
            userData = { referrals: [], dogs: 0 };
            localStorage.setItem(userKey, JSON.stringify(userData));
        }
        return userData;
    }

    function saveUserData(data) {
        const userKey = `user_${userId}`;
        localStorage.setItem(userKey, JSON.stringify(data));
    }

    function simulateReferralJoin() {
        const urlParams = new URLSearchParams(window.location.search);
        const referrerId = urlParams.get('start');
        if (referrerId && referrerId !== userId.toString()) {
            const refKey = `user_${referrerId}`;
            let refData = JSON.parse(localStorage.getItem(refKey)) || { referrals: [], dogs: 0 };
            if (!refData.referrals.includes(userId)) {
                refData.referrals.push(userId);
                refData.dogs += 200;
                localStorage.setItem(refKey, JSON.stringify(refData));
                alert(`You were referred by ${referrerId}. They earned 200 DOGS!`);
            }
        }
    }

    function updateUI() {
        const data = loadUserData();
        document.getElementById("balance").innerText = data.dogs;
        const list = document.getElementById("referralList");
        list.innerHTML = "";
        data.referrals.forEach(r => {
            const li = document.createElement("li");
            li.textContent = `User ${r}`;
            list.appendChild(li);
        });
    }

    simulateReferralJoin();
    updateUI();
</script>
